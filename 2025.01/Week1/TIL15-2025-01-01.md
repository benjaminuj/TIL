# 운영체제
## 운영체제 빌딩과 부팅
### 운영체제 생성
시스템을 구성하려면 어떤 기능이 포함되어야 하는지 명시해야 하는데, 이를 설명하는 매개변수는 구성 파일에 저장

**Linux시스템 빌드 방법**
1. Linux 소스코드 다운로드
2. `make menuconfig`로 커널 구성: .config 구성파일 생성
3. `make`로 메인 커널 컴파일: .config 파일에서 식별된 구성 매개변수를 기반으로 커널을 컴파일해 커널 이미지인 vmlinuz파일 생성
4. `make modules`로 커널 모듈 컴파일
5. 커널 모듈을 vmlinuz에 설치
6. 시스템에 새 커널 설치 

**Linux 가상 머신 설치해 기존 시스템 수정하는 방법**
- 처음부터 가상 머신 빌드
- 이미 구성된 운영체제인 Linux 가상 머신 어플라이언스 사용<br>
: 어플라이언스 다운로드, 가상화 소프트웨어 사용해 설치

### 시스템 부트
하드웨어는 커널의 위치 또는 커널을 적재하는 방법을 어떻게 알까?
- 시스템 부팅 = 커널을 적재해 컴퓨터를 시작하는 과정

**부팅 과정**
1. 부트스트랩 프로그램 또는 부트 로더라고 불리는 작은 코드가 커널의 위치를 찾는다
2. 커널이 메모리에 적재되고 시작
3. 커널은 하드웨어 초기화
4. 루트 파일 시스템이 마운트

- 루트 파일 시스템 (`/`): 파일 시스템의 최상위 디렉터리
- 마운트: 특정 디바이스를 사용하기 위해 하드웨어 장치와 특정 디렉터리를 연결하는 작업

**다단계 부팅과정**
1. 컴퓨터 전원 켜면 비휘발성 펌웨어에 있는 소형 부트 로더 실행
2. 초기 부트 로더는 디스크의 부트 블록에 있는 두 번째 부트 로더를 적재
3. 부트 블록에 저장된 프로그램은 전체 운영체제를 메모리에 적재하고 실행 

최신에는 다단계 방법 대신 하나의 완전한 부팅 관리자로 빠르게 수행

**부트스트랩 프로그램의 작업**
- 커널 프로그램이 포함된 파일을 메모리에 적재
- 진단: 메모리와 CPU 점검<br> 
-> 진단과정 통과해야 부팅 과정 계속 진행 가능
- 시스템 모든 측면 초기화 할 수 있다
- 운영체제 시작 및 루트 파일 시스템 마운트<br>
-> 이 시점이 시스템 '실행 중'

부팅 과정에서 부트 로더는 initramfs로 알려진 임시 RAM 파일 시스템을 생성한다<br>
+임시 RAM 파일 시스템: 실제 루트 파일 시스템을 지원하기 위해 설치해야 하는 드라이버와 커널 모듈이 저장되어 있음 (필요한 드라이버 모두 적재되면 initramfs 폐기) <br>
커널이 시작되고 드라이버 설치되면, 커널은 루트 파일 시스템을 임시 RAM에서 적절한 위치로 옮긴다<br>
마지막으로 시스템의 초기 프로세스인 systemd 프로세스 생성 후 다른 서비스 시작

부트 로더는 복구 모드와 단일 사용자 모드로 부팅할 수 있는 기능 제공
- 복구모드: 하드웨어 문제 진단, 손상된 파일 복구 및 운영체제 재설치 작업
- 단일 사용자 모드

## 운영체제 디버깅

**디버깅** 
- 하드웨어와 소프트웨어의 시스템 오류를 발견하고 수정하는 행위
- 성능 문제는 버그로 간주되므로, 병목현상 제거하는 성능 조정도 디버깅에 포함

### 장애 분석
프로세스 실패시 오류 정보를 로그 파일에 저장, 메모리 상태를 코어 덤프(프로세스가 사용하던 메모리를 캡처)후 파일로 저장

**운영체제 커널 디버깅**
- 커널 장애: 크래시 (crash)
- 오류 정보를 로그 파일에 저장, 메모리 상태를 크래시 덤프

### 성능 관찰 및 조정
**측정 및 표시 도구** 
- 단위: 프로세스별 또는 시스템 전체
- 종류: 카운터, 추적

### 카운터
- 호출된 시스템 콜 횟수 또는 네트워크 장치 또는 디스크에 수행된 작업 수 같은, 시스템 활동 추적
- 통계 모음

**프로세스별**
- ps: 하나의 프로세스에 대한 정보 제공
- top: 현재 프로세스에 대한 실시간 통계

**시스템 전체**
- vmstat: 메모리 사용량 통계
- netstat: 네트워크 인터페이스 통계
- iostat: 디스크의 I/O 사용량

Linux 시스템의 카운터 기반 도구 대부분은 /proc 파일 시스템에서 통계를 읽는다.

**/proc**
- 커널 메모리에만 존재하는 의사 파일 시스템<br>
-> 의사 파일: 실제 디스크에 저장된 데이터가 아니라, 커널이 동적으로 생성해 메모리에 제공하는 파일
- 프로세스별 통계와 커널 통계 질의에 사용됨
- 계층 구조
- 프로세스 고유 정수값이 /proc 아래의 하위 디렉터리로 표시

### 추적
- 시스템 콜과 관련된 단계 같은, 특정 이벤트에 대한 데이터 수집

**프로세스별**
- strace: 프로세스에 의해 호출된 시스템 콜 추적

**시스템 전체**
- tcpdump: 네트워크 패킷 수집