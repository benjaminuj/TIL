# 운영체제

## 1.1 운영체제가 할 일
'컴퓨터 시스템' 구성: 하드웨어, 운영체제, 응용 프로그램, 사용자

- 하드웨어: CPU, I/O 장치, 메모리 -> 계산용 자원 제공
- 응용 프로그램: 사용자 계산 문제를 해결하기 위해 자원이 어떻게 사용될지 정의
- 운영체제: 응용 프로그램 간 하드웨어 사용을 제어하고 조정, 프로그램 작업 환경 제공

컴퓨터 시스템 목표: 프로그램 실행 및 사용자 문제 쉽게 해결할 수 있게 하기 <br>
-> 목표를 위해 '하드웨어 + 응용 프로그램' <br>
프로그램의 입출력 장치 제어 같은 공통 작업(자원 제어 및 할당)을 '운영체제' SW로 통합

- 커널: 컴퓨터에서 항상 실행되는 프로그램
- 시스템 프로그램: 운영체제와 관련
- 응용 프로그램: 시스템 작동과 관련x
- 미들웨어: 응용 프로그램 개발을 쉽게하고 기능 제공

운영체제 구성: 커널, 미들웨어, 시스템 프로그램

## 1.2 컴퓨터 시스템 구성

- CPU
- 장치 컨트롤러: 여러 장치 컨트롤러가 공통버스(구성요소와 공유 메모리 간 액세스 제공)로 연결

**장치 컨트롤러**
- 로컬 버퍼 저장소와 레지스터 집합 유지 관리
- 제어 장치와 로컬 버퍼 저장소 간 데이터 이동

**장치 드라이버**
- 각 장치 컨트롤러마다 존재
- 운영체제에 장치에 대한 인터페이스 제공

CPU와 장치 컨트롤러가 병렬 실행 -> 메모리 사이클 경쟁

**메모리 컨트롤러**
- 메모리 액세스 동기화 

### 1.2.1 인터럽트
- 하드웨어는 시스템 버스 통해 CPU에 신호 보내 인터럽트 발생시킬 수 있다
- CPU 조치가 필요한 이벤트에 대해 경고하는 것
- 운영체제와 하드웨어 사이 상호 작용 방식 핵심


**예시) 입출력 수행 프로그램**
1. 장치 드라이버가 장치 컨트롤러의 레지스터에 값 적재
2. 장치 컨트롤러는 레지스터 내용 검사해 수행할 작업 결정
3. 장치 컨트롤러는 장치에서 로컬 버퍼로 데이터 전송 
4. 전송 완료
5. 장치 컨트롤러는 장치 드라이버에게 작업이 완료됨을 알림
6. 장치 드라이버는 (읽기 요청일 경우) 데이터 또는 데이터 포인터 반환 후 운영체제 다른 부분에 제어 넘김

컨트롤러가 장치 드라이버에게 작업 완료 사실을 어떻게 알리나? 인터럽트를 통해!

1. CPU가 인터럽트 됨
2. CPU는 하던 일 중단하고 고정된 위치로 실행 옮긴다<br>
+고정된 위치: 인터럽트를 유발한 장치를 위한 서비스 루틴이 위치한 시작 주소를 가지고 있다.
3. 인터럽트 서비스 루틴 실행 및 완료
4. CPU는 연산 재개

인터럽트는 적절 서비스 루틴으로 제어 전달<br>
**전달 관리 방법**
- 직선적 방법: 인터럽트 정보 조사하는 일반적 루틴 호출 -> 이후 인터럽트 핸들러 호출
- 간접적 방법: 인터럽트 루틴에 대한 포인터들의 테이블 이용 (직선적 방법보다 빠름)<br>
+테이블에는 여러 장치에 대한 인터럽트 서비스 루틴 주소가 있다<br>
+인터럽트 요청시, 인터럽트 벡터가 장치 번호로 색인된다

**인터럽트 구조**

인터럽트된 모든 정보를 저장해야 인터럽트 처리 후 복원 가능<br>
처리기의 상태 변경 필요할 경우, 인터럽트 루틴은 현재 상태 저장하고 복귀 전 상태를 복원해야 함<br>
인터럽트를 서비스 한 후, 저장되어 있던 복귀 주소를 프로그램 카운터에 적재하고 중단되었던  연산 다시 수행